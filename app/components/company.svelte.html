{{#if !filter || (filter && filter === category)}}
  <div class="company">
    {{#if intialized}}
      <div class="company-heading row">
        <div class="col col-25">
          <p class="rank">
            <span class="sr-only">The overall ranking of this company is</span>
            <span>{{ rank }}</span>
          </p>
        </div>

        <div class="col col-75">
          <h3>{{ company }}</h3>
          <p>
            {{ shortDesc || description }}
            {{#if www}}
              <a href="{{ www.indexOf('http') === 0 ? www : 'http://' + www }}" target="_blank" rel="noopener">{{ www.replace(/(^https?:\/\/(www.)?)|^www./i, '').replace(/\/$/, '') }}</a>
            {{/if}}
          <p>
        </div>
      </div>

      <div class="company-details row">
        <div class="col col-20">
          <dl>
            <dt>Ranking last year:</dt><dd>TODO</dd>
            <dt>City:</dt><dd>{{ city }}</dd>
            <dt>Sector:</dt><dd>TODO</dd>
          </dl>
        </div>

        <div class="col col-20">
          <div class="logo">
            {{#if hasLogo}}
              <img src="./assets/logos/{{ coid }}.png" alt="Company logo for {{ company }}">
            {{/if}}
          </div>
        </div>

        <div class="col col-20">
          {{#if finances}}
            <h4 class="sr-only">Company financial details</h4>

            <dl>
              <dt>Revenue:</dt><dd>${{ currency(finances.revenue) }}</dd>
              <dt>1-year % change:</dt><dd>{{ prevFinances && prevFinances.revenue ? Math.round((finances.revenue - prevFinances.revenue) / prevFinances.revenue) + '%' : '-' }}</dd>
              <dt>Revenue-exp ratio:</dt><dd>{{ Math.round(finances.revenue / finances.expenses * 100) / 100 }}</dd>
              <dt>Excess:</dt><dd>${{ currency(finances.excess) }}</dd>
            </dl>
          {{/if}}
        </div>

        <div class="col col-20">
          <div class="ceo-headshot" data-officer-id="{{ officer.officerId }}">
            {{#if officer && officer.hasImage}}
              <img src="./assets/ceos/{{ officer.officerId }}.png" alt="Headshot for {{ officer.first + ' ' + officer.last }}">
            {{else}}
              <img src="./assets/images/generic-headshot.jpg" alt="Generic headshot image">
            {{/if}}
          </div>
        </div>

        <div class="col col-20">
          {{#if officer}}
            <h4 class="sr-only">Leadership details</h4>

            <dl>
              <dt>CEO:</dt><dd>{{ officer.first + ' ' + officer.last }}</dd>
              <dt>Compensation:</dt><dd>${{ currency(officer.total) }}</dd>
              <dt>1-year % change:</dt><dd>-</dd>
              <dt>Compensation as % of expenses:</dt><dd>{{ Math.round(officer.total / finances.revenue * 100 * 10000) / 10000 }}%</dd>
            </dl>
          {{/if}}
        </div>
      </div>
    {{/if}}
  </div>
{{/if}}

<script>
export default {
  oncreate: function() {
    // Allow data to set all propeties, since we can't set
    // all from the markup of a component
    this.observe('data', d => {
      console.log(d);
      if (_.isPlainObject(d)) {
        this.set(d);
        this.set({ intialized: true });
      }
    });
  },

  helpers: {
    currency: new Intl.NumberFormat({ currency: 'USD' }).format
  }
};
</script>
